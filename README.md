# ST-Manager-serverplugin

SillyTavern èµ„æºç®¡ç†ä¸è‡ªåŠ¨åŒ–å·¥å…· - å®Œæ•´é›†æˆæ’ä»¶

## âœ¨ åŠŸèƒ½

### ğŸ“Š èµ„æºç®¡ç†
- **è§’è‰²å¡ç®¡ç†** - æµè§ˆã€æœç´¢ã€ç¼–è¾‘è§’è‰²å¡
- **ä¸–ç•Œä¹¦ç®¡ç†** - æŸ¥çœ‹å’Œç®¡ç†ä¸–ç•Œä¹¦æ¡ç›®
- **é¢„è®¾ç®¡ç†** - ç®¡ç†é¢„è®¾åŠå…¶ç»‘å®šæ­£åˆ™
- **æ­£åˆ™è„šæœ¬ç®¡ç†** - å®Œæ•´çš„å…¨å±€å’Œé¢„è®¾ç»‘å®šæ­£åˆ™ç®¡ç†ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰
  - å…¨å±€æ­£åˆ™æå–ï¼ˆä» settings.jsonï¼‰
  - é¢„è®¾ç»‘å®šæ­£åˆ™æå–
  - æ­£åˆ™è„šæœ¬æ–‡ä»¶ç®¡ç†
  - æ­£åˆ™èšåˆä¸ç»Ÿè®¡

### ğŸ’¾ å¤‡ä»½ä¸æ¢å¤
- **ä¸€é”®å¤‡ä»½** - æ”¯æŒå…¨é‡å’Œå¢é‡å¤‡ä»½
- **å®šæ—¶å¤‡ä»½** - æ¯æ—¥/æ¯å‘¨è‡ªåŠ¨å¤‡ä»½
- **å¤‡ä»½æ¢å¤** - ä»å†å²å¤‡ä»½æ¢å¤æ•°æ®
- **è¿‡æœŸæ¸…ç†** - è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½

### âš™ï¸ è‡ªåŠ¨åŒ–è§„åˆ™
- **æ¡ä»¶åŒ¹é…** - å¤šæ¡ä»¶ç»„åˆåŒ¹é…è§’è‰²å¡
- **æ‰¹é‡æ“ä½œ** - æ‰¹é‡æ·»åŠ æ ‡ç­¾ã€ç§»åŠ¨æ–‡ä»¶å¤¹
- **è§„åˆ™é¢„è§ˆ** - æ‰§è¡Œå‰é¢„è§ˆåŒ¹é…ç»“æœ
- **è§„åˆ™é›†ç®¡ç†** - ä¿å­˜å’Œå¤ç”¨è§„åˆ™é›†

## ğŸ“¦ å®‰è£…

### 1. å¯ç”¨æœåŠ¡ç«¯æ’ä»¶

ç¼–è¾‘ SillyTavern çš„ `config.yaml`ï¼š

```yaml
enableServerPlugins: true
```

### 2. å…‹éš†æ’ä»¶ä»“åº“

```bash
cd SillyTavern/plugins
git clone https://github.com/Youzini-afk/ST-Manager-serverplugin.git
```

### 3. é‡å¯ SillyTavern

**âœ¨ å°±è¿™ä¹ˆç®€å•ï¼**

é‡å¯åï¼š
- âœ… æœåŠ¡ç«¯æ’ä»¶è‡ªåŠ¨åŠ è½½
- âœ… å‰ç«¯æ‰©å±•è‡ªåŠ¨å®‰è£…åˆ° `public/scripts/extensions/ST-Manager/`
- âœ… å‰ç«¯æ–‡ä»¶å·²é¢„æ„å»ºï¼Œæ— éœ€æ‰‹åŠ¨ npm build

æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
[ST Manager] âœ… å‰ç«¯æ‰©å±•å·²è‡ªåŠ¨å®‰è£…/æ›´æ–° (3 ä¸ªæ–‡ä»¶)
[ST Manager] è¯·åœ¨é…’é¦† UI çš„ Extensions é¢æ¿ä¸­å¯ç”¨ ST Manager
```

### 4. åœ¨é…’é¦†ä¸­å¯ç”¨

æ‰“å¼€ SillyTavern Web ç•Œé¢ï¼š
1. å³ä¾§é¢æ¿ â†’ **Extensions** æ ‡ç­¾é¡µ
2. æ‰¾åˆ° **"ST Manager"** 
3. ç‚¹å‡»å¯ç”¨å³å¯ä½¿ç”¨

---

### ğŸ”§ å¼€å‘è€…ï¼šé‡æ–°æ„å»ºå‰ç«¯

ä»…åœ¨ä¿®æ”¹å‰ç«¯ä»£ç æ—¶éœ€è¦ï¼š
```bash
cd ST-Manager-serverplugin/client
npm install
npx vite build
```

## ğŸ“ ç›®å½•ç»“æ„

```
st-manager/
â”œâ”€â”€ package.json           # æ’ä»¶å…ƒä¿¡æ¯
â”œâ”€â”€ server/                # æœåŠ¡ç«¯æ’ä»¶
â”‚   â”œâ”€â”€ index.js           # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ modules/           # åŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ backup.js      # å¤‡ä»½æ¨¡å—
â”‚       â”œâ”€â”€ cards.js       # è§’è‰²å¡ç®¡ç†
â”‚       â”œâ”€â”€ presets.js     # é¢„è®¾ç®¡ç†
â”‚       â”œâ”€â”€ regex.js       # æ­£åˆ™è„šæœ¬ç®¡ç†ï¼ˆNEWï¼‰
â”‚       â”œâ”€â”€ extensions.js  # æ‰©å±•ç®¡ç†
â”‚       â”œâ”€â”€ worldInfo.js   # ä¸–ç•Œä¹¦ç®¡ç†
â”‚       â”œâ”€â”€ resources.js   # èµ„æºèšåˆ
â”‚       â”œâ”€â”€ automation.js  # è‡ªåŠ¨åŒ–è§„åˆ™
â”‚       â””â”€â”€ config.js      # é…ç½®ç®¡ç†
â””â”€â”€ client/                # å‰ç«¯æ‰©å±•
    â”œâ”€â”€ src/               # æºç 
    â”œâ”€â”€ dist/              # æ„å»ºäº§ç‰©
    â””â”€â”€ package.json       # å‰ç«¯ä¾èµ–
```

## ğŸ”Œ API ç«¯ç‚¹

æ‰€æœ‰ç«¯ç‚¹å‰ç¼€ï¼š`/api/plugins/st-manager`

### åŸºç¡€

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/stats` | GET | èµ„æºç»Ÿè®¡ |
| `/config` | GET/POST | è·å–/æ›´æ–°é…ç½® |

### èµ„æº

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/cards/list` | GET | è§’è‰²å¡åˆ—è¡¨ |
| `/worldbooks/list` | GET | ä¸–ç•Œä¹¦åˆ—è¡¨ |
| `/presets/list` | GET | é¢„è®¾åˆ—è¡¨ |
| `/presets/regex/:presetId` | GET | é¢„è®¾ç»‘å®šçš„æ­£åˆ™ |

### æ­£åˆ™è„šæœ¬ï¼ˆå…¨å±€ä¸é¢„è®¾ç»‘å®šï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/regex/global` | GET | è·å–å…¨å±€æ­£åˆ™ï¼ˆä» settings.jsonï¼‰ |
| `/regex/scripts` | GET | åˆ—å‡ºæ­£åˆ™è„šæœ¬æ–‡ä»¶ |
| `/regex/aggregate` | GET | æ±‡æ€»å…¨å±€ + é¢„è®¾ç»‘å®šæ­£åˆ™ |
| `/regex/extract-from-preset` | POST | ä»é¢„è®¾æ•°æ®æå–æ­£åˆ™ |
| `/regex/list` | GET | æ­£åˆ™è„šæœ¬åˆ—è¡¨ï¼ˆå…¼å®¹è·¯ç”±ï¼‰ |

### å¤‡ä»½

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/backup/trigger` | POST | è§¦å‘å¤‡ä»½ |
| `/backup/list` | GET | å¤‡ä»½åˆ—è¡¨ |
| `/backup/restore` | POST | æ¢å¤å¤‡ä»½ |
| `/backup/delete` | DELETE | åˆ é™¤å¤‡ä»½ |
| `/backup/schedule` | GET/POST | å¤‡ä»½è®¡åˆ’ |

### è‡ªåŠ¨åŒ–

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/automation/rulesets` | GET | è§„åˆ™é›†åˆ—è¡¨ |
| `/automation/ruleset/:id` | GET | è·å–è§„åˆ™é›† |
| `/automation/ruleset` | POST | ä¿å­˜è§„åˆ™é›† |
| `/automation/ruleset/:id` | DELETE | åˆ é™¤è§„åˆ™é›† |
| `/automation/preview` | POST | é¢„è§ˆè§„åˆ™ |
| `/automation/execute` | POST | æ‰§è¡Œè§„åˆ™ |

## ğŸ› ï¸ å¼€å‘

### æ¨¡å—è¯´æ˜

**regex.js** - æ­£åˆ™è„šæœ¬ç®¡ç†æ ¸å¿ƒæ¨¡å—

å®Œæ•´å¤åˆ» Python åç«¯çš„æ­£åˆ™å¤„ç†é€»è¾‘ï¼Œæ”¯æŒï¼š
- å…¨å±€æ­£åˆ™ï¼šä» `settings.json` ä¸­æå–å„ç§æ ¼å¼çš„å…¨å±€æ­£åˆ™è§„åˆ™
- é¢„è®¾ç»‘å®šæ­£åˆ™ï¼šä»é¢„è®¾æ–‡ä»¶ä¸­æå– `extensions.regex_scripts` ç­‰å­—æ®µ
- æ­£åˆ™æ ‡å‡†åŒ–ï¼šæ”¯æŒå¤šç§æ ¼å¼çš„æ­£åˆ™æ¡ç›®è‡ªåŠ¨æ ‡å‡†åŒ–
- æ­£åˆ™å»é‡ï¼šåŸºäº pattern/flags/replace çš„æ™ºèƒ½å»é‡
- æ­£åˆ™èšåˆï¼šæ±‡æ€»å…¨å±€ + é¢„è®¾ç»‘å®šçš„æ‰€æœ‰æ­£åˆ™è§„åˆ™

### æ„å»ºå‰ç«¯

```bash
cd client
npm install
npm run build
```

### è°ƒè¯•

æœåŠ¡ç«¯æ—¥å¿—ä¼šè¾“å‡ºåˆ° SillyTavern æ§åˆ¶å°ï¼Œå‰ç¼€ä¸º `[ST Manager]`ã€‚

## ğŸ“„ License

MIT

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

- GitHub: https://github.com/Youzini-afk/ST-Manager-serverplugin
