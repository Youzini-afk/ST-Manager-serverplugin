<!-- 移动端：执行规则弹窗 -->
<div x-data="executeRulesMobileModal" x-show="showExecuteRulesModal" x-cloak class="modal-overlay z-modal-popover"
    @click.self="showExecuteRulesModal = false">
    <div style="background: var(--bg-panel); padding: 0; border-radius: 1rem; width: 90vw; max-width: 400px; border: 1px solid var(--border-light); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); overflow: hidden; display: flex; flex-direction: column;">
        <!-- Header -->
        <div style="padding: 1rem 1.25rem; background: var(--bg-sub); border-bottom: 1px solid var(--border-light);">
            <h3 style="font-weight: bold; color: var(--text-main); font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                ⚡ 自动处理
            </h3>
        </div>
        
        <div style="padding: 1.25rem;">
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div>
                    <label style="font-weight: 500; margin-bottom: 0.5rem; display: block; font-size: 0.875rem; color: var(--text-main);">选择规则集</label>
                    <!-- 卡片模式提示 -->
                    <div x-show="executeMode === 'cards'" style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.5rem;">
                        将对 <span x-text="cardIds.length" style="font-weight: bold;"></span> 张卡片执行规则
                    </div>
                    <!-- 文件夹模式提示 -->
                    <div x-show="executeMode === 'folder'" style="font-size: 0.75rem; color: var(--text-dim); margin-bottom: 0.5rem;">
                        将对文件夹 <span style="font-weight: bold;" x-text="folderCategory === '' ? '根目录' : folderCategory"></span> 
                        <span x-show="folderRecursive">(包括子文件夹)</span>
                        <span x-show="!folderRecursive">(仅当前文件夹)</span>
                        下的所有卡片执行规则
                    </div>
                    <!-- 规则集列表 -->
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-light); border-radius: 0.5rem; background: var(--bg-sub);">
                        <template x-for="rs in availableRuleSets" :key="rs.id">
                            <button @click="executeRuleSet(rs.id)"
                                class="w-full text-left px-3 py-2 text-sm hover:bg-[var(--bg-hover)] text-[var(--text-main)] border-b border-[var(--border-light)] last:border-b-0 transition-colors"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <span x-text="rs.meta.name || '未命名规则集'"></span>
                                <span style="font-size: 0.75rem; color: var(--text-dim);" x-text="rs.rule_count + ' rules'"></span>
                            </button>
                        </template>
                        <div x-show="availableRuleSets.length === 0" class="px-3 py-4 text-center text-xs text-[var(--text-dim)]">
                            无规则集
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 0.75rem; margin-top: 0.5rem;">
                    <button @click="showExecuteRulesModal = false" class="btn-secondary" style="flex:1; justify-content: center; font-size: 0.875rem; padding: 0.5rem;">
                        取消
                    </button>
                    <button @click="$dispatch('open-automation-modal'); showExecuteRulesModal = false" 
                        class="btn-primary" style="flex:1; justify-content: center; font-size: 0.875rem; padding: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); background-color: #7c3aed;">
                        ⚙️ 管理规则
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
