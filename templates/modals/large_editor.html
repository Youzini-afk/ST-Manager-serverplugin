<!-- Â§ßÁºñËæëÂô® -->
<div x-show="showLargeEditor" x-cloak class="modal-overlay z-modal-popover" @click.stop>
    <div class="modal-container large-editor-container" style="width: 1000px; height: 90vh; max-width: 95vw;"
        @click.away="saveLargeEditor()">
        <!-- È°∂ÈÉ®Ê†è -->
        <div
            style="padding: 1rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; background: var(--bg-sub); flex-shrink: 0;">
            <div class="flex items-center gap-4">
                <h3 class="font-bold flex items-center gap-2" style="font-size: 1.125rem;">
                    <span>üìù</span> <span x-text="largeEditorTitle"></span>
                </h3>

                <!-- === Â∑¶Âè≥ÂàáÊç¢ÂØºËà™Ê†è (‰ªÖÂú®Êï∞ÁªÑÊ®°Âºè‰∏ãÊòæÁ§∫) === -->
                <div x-show="largeEditorIsArray"
                    class="flex items-center ml-4 bg-[var(--bg-panel)] rounded p-1 border border-[var(--border-light)]">
                    <button @click="prevLargeEditorItem()" class="large-editor-nav-btn" title="‰∏ä‰∏Ä‰∏™ (Ëá™Âä®‰øùÂ≠ò)">‚óÄ</button>

                    <!-- ÊòæÁ§∫Á¥¢ÂºïËøõÂ∫¶ -->
                    <span class="large-editor-nav-info">
                        <span x-text="largeEditorIndex + 1"></span> /
                        <span x-text="editingData[largeEditorField] ? editingData[largeEditorField].length : 0"></span>
                    </span>

                    <button @click="nextLargeEditorItem()" class="large-editor-nav-btn" title="‰∏ã‰∏Ä‰∏™ (Ëá™Âä®‰øùÂ≠ò)">‚ñ∂</button>
                </div>
                <!-- Ê®°ÂºèÂàáÊç¢ÊåâÈíÆÁªÑ -->
                <div class="flex items-center gap-2 bg-[var(--bg-sub)] border border-[var(--border-light)] rounded p-1">
                    <!-- ÁºñËæë/È¢ÑËßà ÂàáÊç¢ -->
                    <div class="toggle-btn-group">
                        <button @click="markdownPreview = false" class="toggle-btn"
                            :class="!markdownPreview ? 'active' : ''">ÁºñËæë</button>
                        <button @click="markdownPreview = true" class="toggle-btn"
                            :class="markdownPreview ? 'active' : ''">È¢ÑËßà</button>
                    </div>

                    <!-- Ê∏≤ÊüìÊ†ºÂºèÂàáÊç¢ (‰ªÖÂú®È¢ÑËßàÊ®°Âºè‰∏ãÊòæÁ§∫) -->
                    <div x-show="markdownPreview" class="w-[1px] h-4 bg-[var(--border-light)] mx-1"></div>
                    <div x-show="markdownPreview" class="toggle-btn-group">
                        <button @click="largeRenderMode = 'markdown'" class="toggle-btn"
                            :class="largeRenderMode === 'markdown' ? 'active' : ''" title="Markdown Ëß£Êûê">MD</button>
                        <button @click="largeRenderMode = 'html'" class="toggle-btn"
                            :class="largeRenderMode === 'html' ? 'active' : ''" title="ÂéüÁîü HTML">HTML</button>
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <button @click="showLargeEditor=false"
                    style="color: var(--text-dim); background: none; border: none; cursor: pointer; padding: 0.25rem 0.75rem;">ÂèñÊ∂à
                    (Esc)</button>
                <button @click="saveLargeEditor()" class="btn-primary"
                    style="padding: 0.35rem 1.25rem; border-radius: 0.375rem;">ÂÆåÊàê</button>
            </div>
        </div>

        <!-- ÂÜÖÂÆπÂå∫Âüü -->
        <div
            style="flex: 1; padding: 1rem; display: flex; flex-direction: column; overflow: hidden; background: var(--bg-panel); position: relative;">

            <!-- ÁºñËæëÊ®°Âºè (Textarea) -->
            <textarea x-show="!markdownPreview" x-model="largeEditorContent" @paste="handleNotePaste($event)"
                class="large-editor-textarea custom-scrollbar"
                :style="largeEditorField === 'mes_example' ? 'font-family: monospace; font-size: 0.9rem;' : ''"
                placeholder="Âú®Ê≠§ËæìÂÖ•ÂÜÖÂÆπ... (Êú¨Âú∞Â§áÊ≥®ÊîØÊåÅÁ≤òË¥¥ÂõæÁâá)" spellcheck="false"></textarea>

            <!-- È¢ÑËßàÊ®°ÂºèÔºöÊ†πÊçÆ largeRenderMode ÂÜ≥ÂÆö‰º†‰ªÄ‰πàÁªô updateShadowContent -->
            <!-- 
                    ÈÄªËæëÔºö
                    Â¶ÇÊûúÊòØ HTML Ê®°Âºè -> Áõ¥Êé•‰º† raw content
                    Â¶ÇÊûúÊòØ MD Ê®°Âºè   -> ‰º† renderMarkdown(content)
                -->
            <div x-show="markdownPreview" class="flex-1 overflow-hidden relative"
                style="background: var(--bg-panel); border-radius: 0.375rem;"
                x-effect="updateShadowContent($el, markdownPreview ? (largeRenderMode === 'html' ? largeEditorContent : renderMarkdown(largeEditorContent)) : null)">
            </div>

            <div
                style="text-align: right; color: var(--text-dim); font-size: 0.75rem; margin-top: 0.5rem; flex-shrink: 0;">
                Â≠óÊï∞ÁªüËÆ°: <span x-text="largeEditorContent ? largeEditorContent.length : 0"></span>
                <span
                    x-show="['ui_summary', 'first_mes', 'mes_example', 'description'].includes(largeEditorField) && !markdownPreview"
                    class="ml-2 text-blue-400">
                    üí° ÊîØÊåÅ Markdown/HTML Ê∏≤Êüì
                </span>
            </div>
        </div>
    </div>
</div>